---
// src/pages/blog/[pillar]/[subcategory]/[slug].astro
import { getCollection } from "astro:content";

// Your 4 pillars from config.ts
const VALID_PILLARS = ["auto-insurance", "accidents", "traffic-laws", "leads"];

export async function getStaticPaths() {
  const paths = [];
  
  for (const pillar of VALID_PILLARS) {
    try {
      const articles = await getCollection(pillar);
      
      for (const article of articles) {
        paths.push({
          params: {
            pillar: pillar,
            subcategory: article.data.subcategory,
            slug: article.slug
          },
          props: { article }
        });
      }
    } catch (error) {
      console.log(`No articles in ${pillar} collection yet`);
    }
  }
  
  return paths;
}

const { article } = Astro.props;
const { Content } = await article.render();

// Format display names
const pillarNames = {
  'auto-insurance': 'Auto Insurance',
  'accidents': 'Accidents & Personal Injury',
  'traffic-laws': 'Traffic Laws',
  'leads': 'Insurance & Attorney Leads'
};
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{article.data.title} | AutoInsureGuides</title>
  <meta name="description" content={article.data.description}>
</head>
<body>
  <!-- Breadcrumbs -->
  <nav style="padding: 1rem; background: #f3f4f6;">
    <a href="/">Home</a> &gt; 
    <a href={`/blog/${pillar}`}>{pillarNames[pillar]}</a> &gt; 
    <a href={`/blog/${pillar}/${article.data.subcategory}`}>
      {article.data.subcategory.replace(/-/g, ' ').toUpperCase()}
    </a>
  </nav>
  
  <main style="max-width: 800px; margin: 2rem auto; padding: 0 1rem;">
    <article>
      <h1>{article.data.title}</h1>
      
      {article.data.date && (
        <p style="color: #6b7280;">
          Published: {new Date(article.data.date).toLocaleDateString()}
        </p>
      )}
      
      {article.data.state && (
        <div style="background: #dbeafe; padding: 0.5rem 1rem; border-radius: 0.5rem; display: inline-block; margin-bottom: 1rem;">
          üìç <strong>{article.data.state}</strong> Specific Guide
        </div>
      )}
      
      <Content />
    </article>
  </main>
</body>
</html>